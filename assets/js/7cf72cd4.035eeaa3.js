"use strict";(self.webpackChunkroutr_docs=self.webpackChunkroutr_docs||[]).push([[3173],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>N});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=s(n),k=r,N=m["".concat(p,".").concat(k)]||m[k]||u[k]||l;return n?a.createElement(N,i(i({ref:t},d),{},{components:n})):a.createElement(N,i({ref:t},d))}));function N(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=k;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[m]="string"==typeof e?e:r,i[1]=o;for(var s=2;s<l;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},6702:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>o,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const l={},i="APIServer",o={unversionedId:"development/components/apiserver",id:"development/components/apiserver",title:"APIServer",description:"The APIServer is an optional component that can be used to describe a VoIP network in terms of Domains, Agents, Trunks, Numbers, and Peers. The data is stored in a PostgreSQL database and is accessed by other components via gRPC.",source:"@site/docs/development/components/apiserver.md",sourceDirName:"development/components",slug:"/development/components/apiserver",permalink:"/docs/2.0.0/development/components/apiserver",draft:!1,editUrl:"https://github.com/fonoster/routr-website/edit/main/docs/development/components/apiserver.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"RTPRelay",permalink:"/docs/2.0.0/development/components/rtprelay"},next:{title:"Simple Auth Service",permalink:"/docs/2.0.0/development/components/simpleauth"}},p={},s=[{value:"Configuration Spec",id:"configuration-spec",level:2},{value:"Communication and Protobuf Spec",id:"communication-and-protobuf-spec",level:2},{value:"Launching the APIServer",id:"launching-the-apiserver",level:2},{value:"Quick Test with gRPCurl",id:"quick-test-with-grpcurl",level:2}],d={toc:s},m="wrapper";function u(e){let{components:t,...n}=e;return(0,r.kt)(m,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"apiserver"},"APIServer"),(0,r.kt)("p",null,"The APIServer is an optional component that can be used to describe a VoIP network in terms of Domains, Agents, Trunks, Numbers, and Peers. The data is stored in a PostgreSQL database and is accessed by other components via gRPC."),(0,r.kt)("p",null,"The APIServer has two implementations: the ",(0,r.kt)("inlineCode",{parentName:"p"},"pgdata")," for persistent data storage in a PostgreSQL database and the ",(0,r.kt)("inlineCode",{parentName:"p"},"simpledata")," for storing data in files. The ",(0,r.kt)("inlineCode",{parentName:"p"},"simpledata")," implementation is intended for testing and small deployments."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"pgdata")," has several advantages over the ",(0,r.kt)("inlineCode",{parentName:"p"},"simpledata")," implementation. The first advantage is that the ",(0,r.kt)("inlineCode",{parentName:"p"},"pgdata")," allows you to manage the data using the CTL and SDK. Additionally, all the data entities support the ",(0,r.kt)("inlineCode",{parentName:"p"},"extended")," attribute, enabling you to store additional data in the database in JSON format\u2014more on this in later sections."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Data Migration")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"pgdata")," implementation uses ",(0,r.kt)("a",{parentName:"p",href:"https://www.prisma.io/"},"Prisma")," to manage the database schema. Prisma is important because it allows us to migrate the database schema to newer versions of Routr easily."),(0,r.kt)("h2",{id:"configuration-spec"},"Configuration Spec"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"pgdata")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"pgdata")," has the following environment variables available for configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"DATABASE_URL")," - The URL of the PostgreSQL database. Example: ",(0,r.kt)("inlineCode",{parentName:"li"},"postgresql://postgres:postgres@localhost:5432/routr")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"BIND_ADDR")," - The address where the APIServer will listen for gRPC requests. Default to ",(0,r.kt)("inlineCode",{parentName:"li"},"0.0.0.0:51907")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"EXTERNAL_SERVER_BIND_ADDR")," - The address where the APIServer will listen for HTTP requests. Default to ",(0,r.kt)("inlineCode",{parentName:"li"},"0.0.0.0:51908")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"TLS_ON")," - Enables TLS for the gRPC server. Default to ",(0,r.kt)("inlineCode",{parentName:"li"},"false")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"VERIFY_CLIENT_CERT")," - Enables client certificate verification. Default to ",(0,r.kt)("inlineCode",{parentName:"li"},"false")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CACERT")," - The path to the CA certificate. Default to ",(0,r.kt)("inlineCode",{parentName:"li"},"/etc/routr/certs/ca.crt")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"SERVER_CERT")," - The path to the server certificate. Default to ",(0,r.kt)("inlineCode",{parentName:"li"},"/etc/routr/certs/server.crt")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ENFORCE_E164")," - Enables E164 validation for Numbers. Default to ",(0,r.kt)("inlineCode",{parentName:"li"},"false")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ENFORCE_E164_WITH_MOBILE_PREFIX")," - Enables E164 validation for Numbers with mobile prefixes. Default to ",(0,r.kt)("inlineCode",{parentName:"li"},"false"))),(0,r.kt)("p",null,"For details about connecting to the ",(0,r.kt)("inlineCode",{parentName:"p"},"pgdata")," to manage the data, see the ",(0,r.kt)("a",{parentName:"p",href:"../ctl/README.md"},"CTL")," and ",(0,r.kt)("a",{parentName:"p",href:"../sdk/README.md"},"SDK")," documentation."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"simpledata")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"simpledata")," has the following environment variables available for configuration:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"PATH_TO_RESOURCES")," - The path to the directory where the data will be stored. Example: ",(0,r.kt)("inlineCode",{parentName:"li"},"/etc/routr/resources")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"BIND_ADDR")," - The address where the APIServer will listen for gRPC requests. Default to ",(0,r.kt)("inlineCode",{parentName:"li"},"0.0.0.0:51907"))),(0,r.kt)("p",null,"Both implementations provide Routr with the same protobuf interface, so you can switch between them without changing the other components. "),(0,r.kt)("p",null,"In your resources directory, you will find the following files:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"agents.yaml")," - A list of Agents"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"domains.yaml")," - A list of Domains to which Agents belong"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"trunks.yaml")," - Represents the list of Trunks"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"numbers.yaml")," - A list of Numbers to which Trunks belong"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"peers.yaml")," - A list of Peers that cooperate with Routr (e.g., Asterisk, FreeSWITCH, etc.)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"credentials.yaml")," - A list of Credentials for Peers and Agents"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"acl.yaml")," - The list of ACLs")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You may also provide a ",(0,r.kt)("inlineCode",{parentName:"p"},".json")," file instead of a ",(0,r.kt)("inlineCode",{parentName:"p"},".yaml")," file.")),(0,r.kt)("p",null,"The Agents configuration file has the following structure:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"apiVersion")),(0,r.kt)("td",{parentName:"tr",align:null},"The API version of the Agent"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kind")),(0,r.kt)("td",{parentName:"tr",align:null},"The kind of resource"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ref")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the Agent"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"metadata.name")),(0,r.kt)("td",{parentName:"tr",align:null},"A friendly name for the Agent"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.username")),(0,r.kt)("td",{parentName:"tr",align:null},"The username of the Agent"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.domainRef")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the Domain of the Agent"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.credentialsRef")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the Credentials of the Agent"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.privacy")),(0,r.kt)("td",{parentName:"tr",align:null},"The privacy settings of the Agent (",(0,r.kt)("inlineCode",{parentName:"td"},"Private")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"None"),")"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.enabled")),(0,r.kt)("td",{parentName:"tr",align:null},"The enabled status of the Agent (reserved for future use)"),(0,r.kt)("td",{parentName:"tr",align:null},"No")))),(0,r.kt)("p",null,"An example of an Agents configuration file:"),(0,r.kt)("p",null,"Filename: ",(0,r.kt)("inlineCode",{parentName:"p"},"agents.yaml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'- apiVersion: v2beta1\n  kind: Agent\n  ref: agent-01\n  metadata:\n    name: John Doe\n  spec:\n    username: "1001"\n    domainRef: domain-01\n    credentialsRef: credentials-01\n    privacy: Private\n')),(0,r.kt)("p",null,"In the example above, the Agent ",(0,r.kt)("inlineCode",{parentName:"p"},"agent-01")," has the username ",(0,r.kt)("inlineCode",{parentName:"p"},"1001"),", belongs to the Domain ",(0,r.kt)("inlineCode",{parentName:"p"},"domain-01"),", and uses the Credentials ",(0,r.kt)("inlineCode",{parentName:"p"},"credentials-01"),". Both the Domain and the Credentials are required for the Agent to work."),(0,r.kt)("p",null,"The Domains configuration file has the following structure:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"apiVersion")),(0,r.kt)("td",{parentName:"tr",align:null},"The API version of the Domain"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kind")),(0,r.kt)("td",{parentName:"tr",align:null},"The kind of resource"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ref")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the Domain"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"metadata.name")),(0,r.kt)("td",{parentName:"tr",align:null},"A friendly name for the Domain"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.context.domainUri")),(0,r.kt)("td",{parentName:"tr",align:null},"The domain URI"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.context.egressPolicies")),(0,r.kt)("td",{parentName:"tr",align:null},"The list of egress policies"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.context.egressPolicies[*].rule")),(0,r.kt)("td",{parentName:"tr",align:null},"The regular expression to match the number"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.context.egressPolicies[*].numberRef")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the Number"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")))),(0,r.kt)("p",null,"An example of a Domains configuration file:"),(0,r.kt)("p",null,"Filename: ",(0,r.kt)("inlineCode",{parentName:"p"},"domains.yaml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'- apiVersion: v2beta1\n  kind: Domain\n  ref: domain-01\n  metadata:\n    name: Local Domain\n  spec:\n    context:\n      domainUri: sip.local\n      egressPolicies:\n        - rule: ".*"\n          numberRef: number-01\n')),(0,r.kt)("p",null,"In the example above, the Domain ",(0,r.kt)("inlineCode",{parentName:"p"},"domain-01")," has the Domain URI ",(0,r.kt)("inlineCode",{parentName:"p"},"sip.local")," and the egress policy ",(0,r.kt)("inlineCode",{parentName:"p"},".*")," that matches all numbers. The egress policy is associated with the Number ",(0,r.kt)("inlineCode",{parentName:"p"},"number-01"),". The Number ",(0,r.kt)("inlineCode",{parentName:"p"},"number-01")," is required for the Domain to work."),(0,r.kt)("p",null,"Numbers are used to route calls from and to the PSTN. The Numbers configuration file has the following structure:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"apiVersion")),(0,r.kt)("td",{parentName:"tr",align:null},"The API version of the Number"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kind")),(0,r.kt)("td",{parentName:"tr",align:null},"The kind of resource"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ref")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the Number"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"metadata.name")),(0,r.kt)("td",{parentName:"tr",align:null},"A friendly name for the Number"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"metadata.geoInfo.city")),(0,r.kt)("td",{parentName:"tr",align:null},"The city where the Number is located"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"metadata.geoInfo.country")),(0,r.kt)("td",{parentName:"tr",align:null},"The country where the Number is located"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"metadata.geoInfo.countryISOCode")),(0,r.kt)("td",{parentName:"tr",align:null},"The ISO code of the country"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.trunkRef")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the Trunk"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.location.telUrl")),(0,r.kt)("td",{parentName:"tr",align:null},"The tel URL of the Number"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.location.aorLink")),(0,r.kt)("td",{parentName:"tr",align:null},"The Address of Record (AOR) of the Number"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.location.sessionAffinityHeader")),(0,r.kt)("td",{parentName:"tr",align:null},"The session affinity header of the Number"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.location.extraHeaders")),(0,r.kt)("td",{parentName:"tr",align:null},"The extra headers of the Number"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.location.extraHeaders[*].name")),(0,r.kt)("td",{parentName:"tr",align:null},"The name of the extra header"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")))),(0,r.kt)("p",null,"Tthe ' tel: ' scheme is required when setting the ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.location.telUrl")," property. For example, ",(0,r.kt)("inlineCode",{parentName:"p"},"tel:+17066041487"),". Here, ",(0,r.kt)("inlineCode",{parentName:"p"},"tel:")," indicates that the URI is a telephone number. Please remember that it must match the number sent by your VoIP provider."),(0,r.kt)("p",null,"Another important property is the ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.location.aorLink"),". The important thing is that the AOR must be present in the location table in the Location Service. Otherwise, the call will fail. The AOR can be a SIP URI or a backend URI. Typically, you will use SIP URIs to route calls to Agents and backend URIs to route calls to Peers."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.location.sessionAffinityHeader"),' tells the Location Service to use a specific header to identify the session. This property is helpful in combination with "backend" URIs. For example, if you have a conference server and want to ensure that all calls to the same conference room are routed to the same server, you can use the ',(0,r.kt)("inlineCode",{parentName:"p"},"X-Room-Id")," header to identify the session. The Location Service will use the header's value to identify the session."),(0,r.kt)("p",null,"An example of a Numbers configuration file:"),(0,r.kt)("p",null,"Filename: ",(0,r.kt)("inlineCode",{parentName:"p"},"numbers.yaml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'- apiVersion: v2beta1\n  kind: Number\n  ref: number-01\n  metadata:\n    name: "(706)604-1487"\n    geoInfo:\n      city: Columbus, GA\n      country: USA\n      countryISOCode: US\n  spec:\n    trunkRef: trunk-01\n    location:\n      telUrl: tel:+17066041487\n      aorLink: backend:conference\n      sessionAffinityHeader: X-Room-Id\n      extraHeaders:\n        - name: X-Room-Id\n          value: jsa-shqm-iyo\n')),(0,r.kt)("p",null,"Numbers must be associated with a Trunk to work. "),(0,r.kt)("p",null,"The Trunks configuration file has the following structure:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"apiVersion")),(0,r.kt)("td",{parentName:"tr",align:null},"The API version of the Trunk"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kind")),(0,r.kt)("td",{parentName:"tr",align:null},"The kind of resource"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ref")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the Trunk"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"metadata.name")),(0,r.kt)("td",{parentName:"tr",align:null},"A friendly name for the Trunk"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"metadata.region")),(0,r.kt)("td",{parentName:"tr",align:null},"Reserved for future use"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.inbound.uri")),(0,r.kt)("td",{parentName:"tr",align:null},"The inbound URI of the Trunk"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.inbound.accessControlListRef")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the ACL of the Trunk"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.outbound.sendRegister")),(0,r.kt)("td",{parentName:"tr",align:null},"Enables outbound registration"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.outbound.credentialsRef")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the Credentials of the Trunk"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.outbound.uris")),(0,r.kt)("td",{parentName:"tr",align:null},"The list of outbound URIs"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.outbound.uris[*].uri")),(0,r.kt)("td",{parentName:"tr",align:null},"The outbound URI"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.outbound.uris[*].priority")),(0,r.kt)("td",{parentName:"tr",align:null},"Reserved for future use"),(0,r.kt)("td",{parentName:"tr",align:null},"NA")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.outbound.uris[*].weight")),(0,r.kt)("td",{parentName:"tr",align:null},"Reserved for future use"),(0,r.kt)("td",{parentName:"tr",align:null},"NA")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.outbound.uris[*].enabled")),(0,r.kt)("td",{parentName:"tr",align:null},"Reserved for future use"),(0,r.kt)("td",{parentName:"tr",align:null},"NA")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.outbound.uris[*].transport")),(0,r.kt)("td",{parentName:"tr",align:null},"The transport of the outbound URI"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.outbound.uris[*].user")),(0,r.kt)("td",{parentName:"tr",align:null},"The user of the outbound URI"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.outbound.uris[*].host")),(0,r.kt)("td",{parentName:"tr",align:null},"The host of the outbound URI"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.outbound.uris[*].port")),(0,r.kt)("td",{parentName:"tr",align:null},"The port of the outbound URI"),(0,r.kt)("td",{parentName:"tr",align:null},"No")))),(0,r.kt)("p",null,"An example of a Trunks configuration file:"),(0,r.kt)("p",null,"Filename: ",(0,r.kt)("inlineCode",{parentName:"p"},"trunks.yaml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- apiVersion: v2beta1\n  kind: Trunk\n  ref: trunk-01\n  metadata:\n    name: Test Trunk\n    region: us-east1\n  spec:\n    inbound:\n      uri: trunk01.acme.com\n      accessControlListRef: acl-01\n    outbound:\n      sendRegister: true\n      credentialsRef: credentials-04\n      uris:\n        - uri:\n            user: pbx-1\n            host: sip.provider.net\n            port: 7060\n            transport: udp\n          enabled: true\n")),(0,r.kt)("p",null,"In the ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.inbound")," section, the ",(0,r.kt)("inlineCode",{parentName:"p"},"uri")," property helps Routr to identify the Trunk. Calls from the PSTN using the ",(0,r.kt)("inlineCode",{parentName:"p"},"uri")," will be routed to the Trunk. The ",(0,r.kt)("inlineCode",{parentName:"p"},"accessControlListRef")," property restricts the access to the Trunk. The ",(0,r.kt)("inlineCode",{parentName:"p"},"accessControlListRef")," is optional."),(0,r.kt)("p",null,"In the ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.outbound")," section, the ",(0,r.kt)("inlineCode",{parentName:"p"},"sendRegister")," property enables registration outbound registrations while the ",(0,r.kt)("inlineCode",{parentName:"p"},"credentialsRef")," property for authentication with your trunk provider."),(0,r.kt)("p",null,"In Routr, a Peer is a SIP entity that belongs to the same network as Routr. For example, Asterisk, FreeSWITCH, etc. The Peers configuration file has the following structure:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"apiVersion")),(0,r.kt)("td",{parentName:"tr",align:null},"The API version of the Peer"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kind")),(0,r.kt)("td",{parentName:"tr",align:null},"The kind of resource"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ref")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the Peer"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"metadata.name")),(0,r.kt)("td",{parentName:"tr",align:null},"A friendly name for the Peer"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.aor")),(0,r.kt)("td",{parentName:"tr",align:null},"The Address of Record (AOR) of the Peer"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.username")),(0,r.kt)("td",{parentName:"tr",align:null},"The username of the Peer"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.credentialsRef")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the Credentials of the Peer"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.loadBalancing.withSessionAffinity")),(0,r.kt)("td",{parentName:"tr",align:null},"Enables session affinity"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.loadBalancing.algorithm")),(0,r.kt)("td",{parentName:"tr",align:null},"The load balancing algorithm"),(0,r.kt)("td",{parentName:"tr",align:null},"No")))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.loadBalancing.withSessionAffinity")," property enables session affinity, and the ",(0,r.kt)("inlineCode",{parentName:"p"},"spec.loadBalancing.algorithm")," property sets the load-balancing algorithm. The available algorithms are ",(0,r.kt)("inlineCode",{parentName:"p"},"least-sessions")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"round-robin"),"."),(0,r.kt)("p",null,"Remember that for the ",(0,r.kt)("inlineCode",{parentName:"p"},"least-sessions")," algorithm to work, your SIP backend includes the special header ",(0,r.kt)("inlineCode",{parentName:"p"},"X-Session-Count")," with the number of active sessions as part of the registration request."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"We are evaluating more flexible options to provide the session count, but as of now, you also need to make sure that registration requests happen frequently enough to keep the session count up to date.")),(0,r.kt)("p",null,"An example of a Peers configuration file:"),(0,r.kt)("p",null,"Filename: ",(0,r.kt)("inlineCode",{parentName:"p"},"peers.yaml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- apiVersion: v2beta1\n  kind: Peer\n  ref: peer-01\n  metadata:\n    name: Asterisk (Media Server)\n  spec:\n    aor: backend:conference\n    username: asterisk\n    credentialsRef: credentials-03\n    loadBalancing:\n     withSessionAffinity: true\n     algorithm: least-sessions\n")),(0,r.kt)("p",null,"Credentials in Routr help Agents and Peers authenticate with Routr."),(0,r.kt)("p",null,"The Credentials configuration file has the following structure:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"apiVersion")),(0,r.kt)("td",{parentName:"tr",align:null},"The API version of the Credentials"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kind")),(0,r.kt)("td",{parentName:"tr",align:null},"The kind of resource"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ref")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the Credentials"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"metadata.name")),(0,r.kt)("td",{parentName:"tr",align:null},"A friendly name for the Credentials"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.credentials.username")),(0,r.kt)("td",{parentName:"tr",align:null},"The username of the Credentials"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.credentials.password")),(0,r.kt)("td",{parentName:"tr",align:null},"The password of the Credentials"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")))),(0,r.kt)("p",null,"An example of a Credentials configuration file:"),(0,r.kt)("p",null,"Filename: ",(0,r.kt)("inlineCode",{parentName:"p"},"credentials.yaml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'- apiVersion: v2beta1\n  kind: Credentials\n  ref: credentials-01\n  metadata:\n    name: Agent Credentials\n  spec:\n    credentials:\n      username: "1001"\n      password: "1234"\n')),(0,r.kt)("p",null,"Routr also supports ACLs. ACLs are used to restrict access to Trunks and Domains. "),(0,r.kt)("p",null,"The ACLs configuration file has the following structure:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Required"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"apiVersion")),(0,r.kt)("td",{parentName:"tr",align:null},"The API version of the ACL"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"kind")),(0,r.kt)("td",{parentName:"tr",align:null},"The kind of resource"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ref")),(0,r.kt)("td",{parentName:"tr",align:null},"Reference to the ACL"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"metadata.name")),(0,r.kt)("td",{parentName:"tr",align:null},"A friendly name for the ACL"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.accessControlList.deny")),(0,r.kt)("td",{parentName:"tr",align:null},"The list of deny rules"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.accessControlList.deny[*]")),(0,r.kt)("td",{parentName:"tr",align:null},"The deny rule"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.accessControlList.allow")),(0,r.kt)("td",{parentName:"tr",align:null},"The list of allow rules"),(0,r.kt)("td",{parentName:"tr",align:null},"No")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"spec.accessControlList.allow[*]")),(0,r.kt)("td",{parentName:"tr",align:null},"The allow rule"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")))),(0,r.kt)("p",null,"An example of an ACLs configuration file:"),(0,r.kt)("p",null,"Filename: ",(0,r.kt)("inlineCode",{parentName:"p"},"acl.yaml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- apiVersion: v2beta1\n  kind: AccessControlList\n  ref: acl-01\n  metadata:\n    name: Europe ACL\n  spec:\n    accessControlList:\n      deny:\n        - 0.0.0.0/1\n      allow:\n        - 192.168.1.3/31\n        - 127.0.0.1/8\n        - 10.111.221.22/31\n")),(0,r.kt)("h2",{id:"communication-and-protobuf-spec"},"Communication and Protobuf Spec"),(0,r.kt)("p",null,"Components communicate with the APIServer using gRPC. That includes SDKs, Command-line tools, Processors, Middleware, etc."),(0,r.kt)("p",null,"The following protobuf defines the Agent service interface:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},'syntax = "proto3";\n\npackage fonoster.routr.connect.agents.v2beta1;\n\n// The Agents service definition\nservice Agents {\n  // Creates a new Agent\n  rpc Create (CreateAgentRequest) returns (Agent) {}\n  // Updates an existing Agent\n  rpc Update (UpdateAgentRequest) returns (Agent) {}\n  // Gets an existing Agent\n  rpc Get (GetAgentRequest) returns (Agent) {}\n  // Deletes an existing Agent\n  rpc Delete (DeleteAgentRequest) returns (.google.protobuf.Empty) {}\n  // Lists all Agents\n  rpc List (ListAgentsRequest) returns (ListAgentsResponse) {}\n  // Find Agents by field name and value\n  rpc FindBy (FindByRequest) returns (FindByResponse) {}\n}\n\nenum Privacy {\n  PRIVATE = 0;\n  NONE = 1;\n}\n\n// The message for the Agent resource\nmessage Agent {\n  // The API version of the Agent\n  string api_version = 1;\n  // The unique identifier of the Agent\n  string ref = 2;\n  // The name of the Agent\n  string name = 3;\n  // The username of the Agent\n  string username = 4;\n  // The password of the Agent\n  Privacy privacy = 5;\n  // The enabled status of the Agent\n  bool enabled = 6;\n  // The created_at timestamp of the Agent\n  int32 created_at = 7;\n  // The updated_at timestamp of the Agent\n  int32 updated_at = 8;\n  // The domain of the Agent\n  fonoster.routr.connect.domains.v2beta1.Domain domain = 9;\n  // The credentials of the Agent\n  fonoster.routr.connect.credentials.v2beta1.Credentials credentials = 10;\n  // The extended attributes of the Agent\n  .google.protobuf.Struct extended = 11;  \n}\n\n// The request message for the Agents.Create method\nmessage CreateAgentRequest {\n  // The name of the Agent\n  string name = 1;\n  // The username of the Agent\n  string username = 2;\n  // The password of the Agent\n  Privacy privacy = 3;\n  // The enabled status of the Agent\n  bool enabled = 4;\n  // Reference to the Domain of the Agent\n  string domain_ref = 5;\n  // Reference to the Credentials of the Agent\n  string credentials_ref = 6;\n  // The extended attributes of the Agent\n  .google.protobuf.Struct extended = 7;  \n}\n\n// The request message for the Agents.Update method\nmessage UpdateAgentRequest {\n  // The unique identifier of the Agent\n  string ref = 1;\n  // The name of the Agent\n  string name = 2;\n  // The privacy settings of the Agent\n  Privacy privacy = 3;\n  // The enabled status of the Agent\n  bool enabled = 4;\n  // Reference to the Domain of the Agent\n  string domain_ref = 5;\n  // Reference to the Credentials of the Agent\n  string credentials_ref = 6;\n  // The extended attributes of the Agent\n  .google.protobuf.Struct extended = 7;\n}\n\n// The request message for the Agents.Get method\nmessage GetAgentRequest {\n  // The unique identifier of the Agent\n  string ref = 1;\n}\n\n// The request message for the Agents.Delete method\nmessage DeleteAgentRequest  {\n  // The unique identifier of the Agent\n  string ref = 1;\n}\n\n// The request message for the Agents.FindBy method\nmessage FindByRequest {\n  // The field name to search\n  string field_name = 1;\n  // The value to search\n  string field_value = 2;\n}\n\n// The response message for the Agents.FindBy method\nmessage FindByResponse {\n  // The list of Agents\n  repeated Agent items = 1;\n} \n\n// The request message for the Agents.List method\nmessage ListAgentsRequest {\n  // The maximum number of items in the list\n  int32 page_size = 1;\n\n  // The next_page_token value returned from the previous request, if any\n  string page_token = 2;\n}\n\n// The response message for the Agents.List method\nmessage ListAgentsResponse {\n  // List of Agents\n  repeated Agent items = 1;\n\n  // Token to retrieve the next page of results or empty if there are no more results in the list\n  string next_page_token = 2;\n}\n')),(0,r.kt)("p",null,"To see the complete protobuf spec, please visit the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fonoster/routr/tree/main/mods/common/src/connect/protos"},"protobuf directory.")),(0,r.kt)("h2",{id:"launching-the-apiserver"},"Launching the APIServer"),(0,r.kt)("p",null,"Both implementations are available as Docker images from Docker Hub as ",(0,r.kt)("inlineCode",{parentName:"p"},"fonoster/routr-pgdata")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"fonoster/routr-simpledata"),". "),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"pgdata")),(0,r.kt)("p",null,"To launch the ",(0,r.kt)("inlineCode",{parentName:"p"},"pgdata")," implementation with Docker, you can use the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'docker run -it \\\n  -e DATABASE_URL="postgresql://postgres:postgres@localhost:5432/routr" \\\n  -p 51907:51907 \\\n  -p 51908:51908 \\\n  fonoster/routr-pgdata\n')),(0,r.kt)("p",null,"The port ",(0,r.kt)("inlineCode",{parentName:"p"},"51907")," is used for internal communication, and the port ",(0,r.kt)("inlineCode",{parentName:"p"},"51908")," is used for external communication. The CTL and SDK use the external port to manage the data."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"simpledata")),(0,r.kt)("p",null,"To launch the ",(0,r.kt)("inlineCode",{parentName:"p"},"simpledata")," implementation with Docker, you can use the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -it \\\n  -v /path/to/resources:/etc/routr/resources \\\n  -p 51907:51907 \\\n  fonoster/routr-simpledata\n")),(0,r.kt)("h2",{id:"quick-test-with-grpcurl"},"Quick Test with gRPCurl"),(0,r.kt)("p",null,"One easy way to interact with the APIServer for testing and development is to use ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/fullstorydev/grpcurl"},"gRPCurl"),". The following example shows how to send a request to the Agents service within the APIServer:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"grpcurl -plaintext \\\n  -import-path /path/to/protos \\\n  -proto agents.proto  -d '{...}' \\\n  localhost:51907 \\\n  fonoster.routr.connect.agents.v2beta1.Agents/Get\n")),(0,r.kt)("p",null,"Please remember that the ",(0,r.kt)("inlineCode",{parentName:"p"},"simpledata")," implementation does not accept write operations."))}u.isMDXComponent=!0}}]);