<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-2.0.0 docs-doc-page docs-doc-id-development/components/apiserver" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">APIServer | Routr Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://routr.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://routr.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://routr.io/docs/2.0.0/development/components/apiserver"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="2.0.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2.0.0"><meta data-rh="true" name="docsearch:version" content="2.0.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2.0.0"><meta data-rh="true" property="og:title" content="APIServer | Routr Docs"><meta data-rh="true" name="description" content="The APIServer is an optional component that can be used to describe a VoIP network in terms of Domains, Agents, Trunks, Numbers, and Peers. The data is stored in a PostgreSQL database and is accessed by other components via gRPC."><meta data-rh="true" property="og:description" content="The APIServer is an optional component that can be used to describe a VoIP network in terms of Domains, Agents, Trunks, Numbers, and Peers. The data is stored in a PostgreSQL database and is accessed by other components via gRPC."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://routr.io/docs/2.0.0/development/components/apiserver"><link data-rh="true" rel="alternate" href="https://routr.io/docs/2.0.0/development/components/apiserver" hreflang="en"><link data-rh="true" rel="alternate" href="https://routr.io/docs/2.0.0/development/components/apiserver" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://VLT67PBOP0-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JX93S6PKN4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-JX93S6PKN4",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Routr Docs" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.d0b421c9.css">
<script src="/assets/js/runtime~main.1e183b4a.js" defer="defer"></script>
<script src="/assets/js/main.b4990fbf.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Routr Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Routr Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/2.0.0/overview/introduction">Docs</a><a href="https://fonoster.gumroad.com/l/the-future-of-programmable-sip-servers" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Training<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/2.0.0/overview/introduction">2.0.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/2.11.5/development/components/apiserver">2.11.5</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/2.0.0/development/components/apiserver">2.0.0</a></li><li><a class="dropdown__link" href="/docs/1.x.x/welcome">1.x.x</a></li></ul></div><a href="https://github.com/fonoster/routr" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/2.0.0/overview/introduction">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/2.0.0/development/introduction">Development</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/development-mode-with-gitpod">Development with Gitpod</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/2.0.0/development/components/overview">Components</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/components/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/components/edgeport">EdgePort</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/components/dispatcher">Message Dispatcher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/components/location">Location Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/components/registry">Registry Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/components/requester">Requester</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/components/rtprelay">RTPRelay</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/2.0.0/development/components/apiserver">APIServer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/components/simpleauth">SimpleAuth Service</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/2.0.0/development/alterations/overview">Alterations API</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/building-a-processor">Building a Processor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/building-a-middleware">Building a Middleware</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/custom-data-with-the-apiserver">Custom data with the APIServer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.0.0/development/extending-the-ctl">Extending the Command-Line Tool</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/2.0.0/connect/introduction">Connect Mode</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/2.0.0/community">Community</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/2.0.0/contributing">Contributing Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/2.0.0/faqs">FAQs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/2.0.0/changelog">Changelog</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Routr Docs<!-- --> <b>2.0.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/2.11.5/development/components/apiserver">latest version</a></b> (<!-- -->2.11.5<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Development</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Components</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">APIServer</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 2.0.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>APIServer</h1>
<p>The APIServer is an optional component that can be used to describe a VoIP network in terms of Domains, Agents, Trunks, Numbers, and Peers. The data is stored in a PostgreSQL database and is accessed by other components via gRPC.</p>
<p>The APIServer has two implementations: the <code>pgdata</code> for persistent data storage in a PostgreSQL database and the <code>simpledata</code> for storing data in files. The <code>simpledata</code> implementation is intended for testing and small deployments.</p>
<p>The <code>pgdata</code> has several advantages over the <code>simpledata</code> implementation. The first advantage is that the <code>pgdata</code> allows you to manage the data using the CTL and SDK. Additionally, all the data entities support the <code>extended</code> attribute, enabling you to store additional data in the database in JSON format—more on this in later sections.</p>
<p><strong>Data Migration</strong></p>
<p>The <code>pgdata</code> implementation uses <a href="https://www.prisma.io/" target="_blank" rel="noopener noreferrer">Prisma</a> to manage the database schema. Prisma is important because it allows us to migrate the database schema to newer versions of Routr easily.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-spec">Configuration Spec<a class="hash-link" aria-label="Direct link to Configuration Spec" title="Direct link to Configuration Spec" href="/docs/2.0.0/development/components/apiserver#configuration-spec">​</a></h2>
<p><strong>pgdata</strong></p>
<p>The <code>pgdata</code> has the following environment variables available for configuration:</p>
<ul>
<li><code>DATABASE_URL</code> - The URL of the PostgreSQL database. Example: <code>postgresql://postgres:postgres@localhost:5432/routr</code></li>
<li><code>BIND_ADDR</code> - The address where the APIServer will listen for gRPC requests. Default to <code>0.0.0.0:51907</code></li>
<li><code>EXTERNAL_SERVER_BIND_ADDR</code> - The address where the APIServer will listen for HTTP requests. Default to <code>0.0.0.0:51908</code></li>
<li><code>TLS_ON</code> - Enables TLS for the gRPC server. Default to <code>false</code></li>
<li><code>VERIFY_CLIENT_CERT</code> - Enables client certificate verification. Default to <code>false</code></li>
<li><code>CACERT</code> - The path to the CA certificate. Default to <code>/etc/routr/certs/ca.crt</code></li>
<li><code>SERVER_CERT</code> - The path to the server certificate. Default to <code>/etc/routr/certs/server.crt</code></li>
<li><code>ENFORCE_E164</code> - Enables E164 validation for Numbers. Default to <code>false</code></li>
<li><code>ENFORCE_E164_WITH_MOBILE_PREFIX</code> - Enables E164 validation for Numbers with mobile prefixes. Default to <code>false</code></li>
</ul>
<p>For details about connecting to the <code>pgdata</code> to manage the data, see the <a href="/docs/2.0.0/connect/command-line/overview">CTL</a> and <a href="/docs/2.0.0/connect/nodesdk/overview">SDK</a> documentation.</p>
<p><strong>simpledata</strong></p>
<p>The <code>simpledata</code> has the following environment variables available for configuration:</p>
<ul>
<li><code>PATH_TO_RESOURCES</code> - The path to the directory where the data will be stored. Example: <code>/etc/routr/resources</code></li>
<li><code>BIND_ADDR</code> - The address where the APIServer will listen for gRPC requests. Default to <code>0.0.0.0:51907</code></li>
</ul>
<p>Both implementations provide Routr with the same protobuf interface, so you can switch between them without changing the other components.</p>
<p>In your resources directory, you will find the following files:</p>
<ul>
<li><code>agents.yaml</code> - A list of Agents</li>
<li><code>domains.yaml</code> - A list of Domains to which Agents belong</li>
<li><code>trunks.yaml</code> - Represents the list of Trunks</li>
<li><code>numbers.yaml</code> - A list of Numbers to which Trunks belong</li>
<li><code>peers.yaml</code> - A list of Peers that cooperate with Routr (e.g., Asterisk, FreeSWITCH, etc.)</li>
<li><code>credentials.yaml</code> - A list of Credentials for Peers and Agents</li>
<li><code>acl.yaml</code> - The list of ACLs</li>
</ul>
<blockquote>
<p>You may also provide a <code>.json</code> file instead of a <code>.yaml</code> file.</p>
</blockquote>
<p>The Agents configuration file has the following structure:</p>
<table><thead><tr><th>Property</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>apiVersion</code></td><td>The API version of the Agent</td><td>Yes</td></tr><tr><td><code>kind</code></td><td>The kind of resource</td><td>Yes</td></tr><tr><td><code>ref</code></td><td>Reference to the Agent</td><td>Yes</td></tr><tr><td><code>metadata.name</code></td><td>A friendly name for the Agent</td><td>Yes</td></tr><tr><td><code>spec.username</code></td><td>The username of the Agent</td><td>Yes</td></tr><tr><td><code>spec.domainRef</code></td><td>Reference to the Domain of the Agent</td><td>Yes</td></tr><tr><td><code>spec.credentialsRef</code></td><td>Reference to the Credentials of the Agent</td><td>Yes</td></tr><tr><td><code>spec.privacy</code></td><td>The privacy settings of the Agent (<code>Private</code> or <code>None</code>)</td><td>No</td></tr><tr><td><code>spec.enabled</code></td><td>The enabled status of the Agent (reserved for future use)</td><td>No</td></tr></tbody></table>
<p>An example of an Agents configuration file:</p>
<p>Filename: <code>agents.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> agent</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> John Doe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1001&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">domainRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> domain</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">credentialsRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> credentials</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">privacy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Private</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the example above, the Agent <code>agent-01</code> has the username <code>1001</code>, belongs to the Domain <code>domain-01</code>, and uses the Credentials <code>credentials-01</code>. Both the Domain and the Credentials are required for the Agent to work.</p>
<p>The Domains configuration file has the following structure:</p>
<table><thead><tr><th>Property</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>apiVersion</code></td><td>The API version of the Domain</td><td>Yes</td></tr><tr><td><code>kind</code></td><td>The kind of resource</td><td>Yes</td></tr><tr><td><code>ref</code></td><td>Reference to the Domain</td><td>Yes</td></tr><tr><td><code>metadata.name</code></td><td>A friendly name for the Domain</td><td>Yes</td></tr><tr><td><code>spec.context.domainUri</code></td><td>The domain URI</td><td>Yes</td></tr><tr><td><code>spec.context.egressPolicies</code></td><td>The list of egress policies</td><td>No</td></tr><tr><td><code>spec.context.egressPolicies[*].rule</code></td><td>The regular expression to match the number</td><td>Yes</td></tr><tr><td><code>spec.context.egressPolicies[*].numberRef</code></td><td>Reference to the Number</td><td>Yes</td></tr></tbody></table>
<p>An example of a Domains configuration file:</p>
<p>Filename: <code>domains.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> domain</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Local Domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">context</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">domainUri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sip.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">egressPolicies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">rule</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;.*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">numberRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the example above, the Domain <code>domain-01</code> has the Domain URI <code>sip.local</code> and the egress policy <code>.*</code> that matches all numbers. The egress policy is associated with the Number <code>number-01</code>. The Number <code>number-01</code> is required for the Domain to work.</p>
<p>Numbers are used to route calls from and to the PSTN. The Numbers configuration file has the following structure:</p>
<table><thead><tr><th>Property</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>apiVersion</code></td><td>The API version of the Number</td><td>Yes</td></tr><tr><td><code>kind</code></td><td>The kind of resource</td><td>Yes</td></tr><tr><td><code>ref</code></td><td>Reference to the Number</td><td>Yes</td></tr><tr><td><code>metadata.name</code></td><td>A friendly name for the Number</td><td>Yes</td></tr><tr><td><code>metadata.geoInfo.city</code></td><td>The city where the Number is located</td><td>No</td></tr><tr><td><code>metadata.geoInfo.country</code></td><td>The country where the Number is located</td><td>No</td></tr><tr><td><code>metadata.geoInfo.countryISOCode</code></td><td>The ISO code of the country</td><td>No</td></tr><tr><td><code>spec.trunkRef</code></td><td>Reference to the Trunk</td><td>Yes</td></tr><tr><td><code>spec.location.telUrl</code></td><td>The tel URL of the Number</td><td>Yes</td></tr><tr><td><code>spec.location.aorLink</code></td><td>The Address of Record (AOR) of the Number</td><td>Yes</td></tr><tr><td><code>spec.location.sessionAffinityHeader</code></td><td>The session affinity header of the Number</td><td>No</td></tr><tr><td><code>spec.location.extraHeaders</code></td><td>The extra headers of the Number</td><td>No</td></tr><tr><td><code>spec.location.extraHeaders[*].name</code></td><td>The name of the extra header</td><td>Yes</td></tr></tbody></table>
<p>Tthe &#x27; tel: &#x27; scheme is required when setting the <code>spec.location.telUrl</code> property. For example, <code>tel:+17066041487</code>. Here, <code>tel:</code> indicates that the URI is a telephone number. Please remember that it must match the number sent by your VoIP provider.</p>
<p>Another important property is the <code>spec.location.aorLink</code>. The important thing is that the AOR must be present in the location table in the Location Service. Otherwise, the call will fail. The AOR can be a SIP URI or a backend URI. Typically, you will use SIP URIs to route calls to Agents and backend URIs to route calls to Peers.</p>
<p>The <code>spec.location.sessionAffinityHeader</code> tells the Location Service to use a specific header to identify the session. This property is helpful in combination with &quot;backend&quot; URIs. For example, if you have a conference server and want to ensure that all calls to the same conference room are routed to the same server, you can use the <code>X-Room-Id</code> header to identify the session. The Location Service will use the header&#x27;s value to identify the session.</p>
<p>An example of a Numbers configuration file:</p>
<p>Filename: <code>numbers.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;(706)604-1487&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">geoInfo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">city</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Columbus</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">country</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> USA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">countryISOCode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> US</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">trunkRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trunk</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">location</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">telUrl</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">+17066041487</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">aorLink</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">conference@sip.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">sessionAffinityHeader</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> X</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Room</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">extraHeaders</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> X</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Room</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">Id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jsa</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">shqm</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">iyo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Numbers must be associated with a Trunk to work.</p>
<p>The Trunks configuration file has the following structure:</p>
<table><thead><tr><th>Property</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>apiVersion</code></td><td>The API version of the Trunk</td><td>Yes</td></tr><tr><td><code>kind</code></td><td>The kind of resource</td><td>Yes</td></tr><tr><td><code>ref</code></td><td>Reference to the Trunk</td><td>Yes</td></tr><tr><td><code>metadata.name</code></td><td>A friendly name for the Trunk</td><td>Yes</td></tr><tr><td><code>metadata.region</code></td><td>Reserved for future use</td><td>No</td></tr><tr><td><code>spec.inbound.uri</code></td><td>The inbound URI of the Trunk</td><td>Yes</td></tr><tr><td><code>spec.inbound.accessControlListRef</code></td><td>Reference to the ACL of the Trunk</td><td>No</td></tr><tr><td><code>spec.outbound.sendRegister</code></td><td>Enables outbound registration</td><td>No</td></tr><tr><td><code>spec.outbound.credentialsRef</code></td><td>Reference to the Credentials of the Trunk</td><td>No</td></tr><tr><td><code>spec.outbound.uris</code></td><td>The list of outbound URIs</td><td>No</td></tr><tr><td><code>spec.outbound.uris[*].uri</code></td><td>The outbound URI</td><td>Yes</td></tr><tr><td><code>spec.outbound.uris[*].priority</code></td><td>Reserved for future use</td><td>NA</td></tr><tr><td><code>spec.outbound.uris[*].weight</code></td><td>Reserved for future use</td><td>NA</td></tr><tr><td><code>spec.outbound.uris[*].enabled</code></td><td>Reserved for future use</td><td>NA</td></tr><tr><td><code>spec.outbound.uris[*].transport</code></td><td>The transport of the outbound URI</td><td>No</td></tr><tr><td><code>spec.outbound.uris[*].user</code></td><td>The user of the outbound URI</td><td>No</td></tr><tr><td><code>spec.outbound.uris[*].host</code></td><td>The host of the outbound URI</td><td>No</td></tr><tr><td><code>spec.outbound.uris[*].port</code></td><td>The port of the outbound URI</td><td>No</td></tr></tbody></table>
<p>An example of a Trunks configuration file:</p>
<p>Filename: <code>trunks.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Trunk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trunk</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Test Trunk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">region</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> us</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">east1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">inbound</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> trunk01.acme.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">accessControlListRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> acl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">outbound</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">sendRegister</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">credentialsRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> credentials</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">04</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">uris</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pbx</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">host</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sip.provider.net</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7060</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">transport</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the <code>spec.inbound</code> section, the <code>uri</code> property helps Routr to identify the Trunk. Calls from the PSTN using the <code>uri</code> will be routed to the Trunk. The <code>accessControlListRef</code> property restricts the access to the Trunk. The <code>accessControlListRef</code> is optional.</p>
<p>In the <code>spec.outbound</code> section, the <code>sendRegister</code> property enables registration outbound registrations while the <code>credentialsRef</code> property for authentication with your trunk provider.</p>
<p>In Routr, a Peer is a SIP entity that belongs to the same network as Routr. For example, Asterisk, FreeSWITCH, etc. The Peers configuration file has the following structure:</p>
<table><thead><tr><th>Property</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>apiVersion</code></td><td>The API version of the Peer</td><td>Yes</td></tr><tr><td><code>kind</code></td><td>The kind of resource</td><td>Yes</td></tr><tr><td><code>ref</code></td><td>Reference to the Peer</td><td>Yes</td></tr><tr><td><code>metadata.name</code></td><td>A friendly name for the Peer</td><td>Yes</td></tr><tr><td><code>spec.aor</code></td><td>The Address of Record (AOR) of the Peer</td><td>Yes</td></tr><tr><td><code>spec.username</code></td><td>The username of the Peer</td><td>Yes</td></tr><tr><td><code>spec.credentialsRef</code></td><td>Reference to the Credentials of the Peer</td><td>Yes</td></tr><tr><td><code>spec.loadBalancing.withSessionAffinity</code></td><td>Enables session affinity</td><td>No</td></tr><tr><td><code>spec.loadBalancing.algorithm</code></td><td>The load balancing algorithm</td><td>No</td></tr></tbody></table>
<p>The <code>spec.loadBalancing.withSessionAffinity</code> property enables session affinity, and the <code>spec.loadBalancing.algorithm</code> property sets the load-balancing algorithm. The available algorithms are <code>least-sessions</code> and <code>round-robin</code>.</p>
<p>Remember that for the <code>least-sessions</code> algorithm to work, your SIP backend includes the special header <code>X-Session-Count</code> with the number of active sessions as part of the registration request.</p>
<blockquote>
<p>We are evaluating more flexible options to provide the session count, but as of now, you also need to make sure that registration requests happen frequently enough to keep the session count up to date.</p>
</blockquote>
<p>An example of a Peers configuration file:</p>
<p>Filename: <code>peers.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Peer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> peer</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Asterisk (Media Server)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">aor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">conference@sip.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> asterisk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">credentialsRef</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> credentials</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">03</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">loadBalancing</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">withSessionAffinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token key atrule" style="color:#00a4db">algorithm</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> least</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sessions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Credentials in Routr help Agents and Peers authenticate with Routr.</p>
<p>The Credentials configuration file has the following structure:</p>
<table><thead><tr><th>Property</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>apiVersion</code></td><td>The API version of the Credentials</td><td>Yes</td></tr><tr><td><code>kind</code></td><td>The kind of resource</td><td>Yes</td></tr><tr><td><code>ref</code></td><td>Reference to the Credentials</td><td>Yes</td></tr><tr><td><code>metadata.name</code></td><td>A friendly name for the Credentials</td><td>Yes</td></tr><tr><td><code>spec.credentials.username</code></td><td>The username of the Credentials</td><td>Yes</td></tr><tr><td><code>spec.credentials.password</code></td><td>The password of the Credentials</td><td>Yes</td></tr></tbody></table>
<p>An example of a Credentials configuration file:</p>
<p>Filename: <code>credentials.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> credentials</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Agent Credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">credentials</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1001&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1234&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Routr also supports ACLs. ACLs are used to restrict access to Trunks and Domains.</p>
<p>The ACLs configuration file has the following structure:</p>
<table><thead><tr><th>Property</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>apiVersion</code></td><td>The API version of the ACL</td><td>Yes</td></tr><tr><td><code>kind</code></td><td>The kind of resource</td><td>Yes</td></tr><tr><td><code>ref</code></td><td>Reference to the ACL</td><td>Yes</td></tr><tr><td><code>metadata.name</code></td><td>A friendly name for the ACL</td><td>Yes</td></tr><tr><td><code>spec.accessControlList.deny</code></td><td>The list of deny rules</td><td>No</td></tr><tr><td><code>spec.accessControlList.deny[*]</code></td><td>The deny rule</td><td>Yes</td></tr><tr><td><code>spec.accessControlList.allow</code></td><td>The list of allow rules</td><td>No</td></tr><tr><td><code>spec.accessControlList.allow[*]</code></td><td>The allow rule</td><td>Yes</td></tr></tbody></table>
<p>An example of an ACLs configuration file:</p>
<p>Filename: <code>acl.yaml</code></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v2beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> AccessControlList</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ref</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> acl</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Europe ACL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">accessControlList</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">deny</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 0.0.0.0/1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">allow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 192.168.1.3/31</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 127.0.0.1/8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 10.111.221.22/31</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="communication-and-protobuf-spec">Communication and Protobuf Spec<a class="hash-link" aria-label="Direct link to Communication and Protobuf Spec" title="Direct link to Communication and Protobuf Spec" href="/docs/2.0.0/development/components/apiserver#communication-and-protobuf-spec">​</a></h2>
<p>Components communicate with the APIServer using gRPC. That includes SDKs, Command-line tools, Processors, Middleware, etc.</p>
<p>The following protobuf defines the Agent service interface:</p>
<div class="language-protobuf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-protobuf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package fonoster.routr.connect.agents.v2beta1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The Agents service definition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service Agents {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Creates a new Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Create (CreateAgentRequest) returns (Agent) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Updates an existing Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Update (UpdateAgentRequest) returns (Agent) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Gets an existing Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Get (GetAgentRequest) returns (Agent) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Deletes an existing Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc Delete (DeleteAgentRequest) returns (.google.protobuf.Empty) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Lists all Agents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc List (ListAgentsRequest) returns (ListAgentsResponse) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Find Agents by field name and value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rpc FindBy (FindByRequest) returns (FindByResponse) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum Privacy {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PRIVATE = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  NONE = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The message for the Agent resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Agent {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The API version of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string api_version = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The unique identifier of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string ref = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The name of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string name = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The username of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string username = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The password of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Privacy privacy = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The enabled status of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool enabled = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The created_at timestamp of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 created_at = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The updated_at timestamp of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 updated_at = 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The domain of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fonoster.routr.connect.domains.v2beta1.Domain domain = 9;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The credentials of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fonoster.routr.connect.credentials.v2beta1.Credentials credentials = 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The extended attributes of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .google.protobuf.Struct extended = 11;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The request message for the Agents.Create method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message CreateAgentRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The name of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string name = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The username of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string username = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The password of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Privacy privacy = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The enabled status of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool enabled = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Reference to the Domain of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string domain_ref = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Reference to the Credentials of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string credentials_ref = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The extended attributes of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .google.protobuf.Struct extended = 7;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The request message for the Agents.Update method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message UpdateAgentRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The unique identifier of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string ref = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The name of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string name = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The privacy settings of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Privacy privacy = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The enabled status of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool enabled = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Reference to the Domain of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string domain_ref = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Reference to the Credentials of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string credentials_ref = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The extended attributes of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  .google.protobuf.Struct extended = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The request message for the Agents.Get method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message GetAgentRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The unique identifier of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string ref = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The request message for the Agents.Delete method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message DeleteAgentRequest  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The unique identifier of the Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string ref = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The request message for the Agents.FindBy method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message FindByRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The field name to search</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string field_name = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The value to search</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string field_value = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The response message for the Agents.FindBy method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message FindByResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The list of Agents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated Agent items = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The request message for the Agents.List method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message ListAgentsRequest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The maximum number of items in the list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 page_size = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The next_page_token value returned from the previous request, if any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string page_token = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// The response message for the Agents.List method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message ListAgentsResponse {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // List of Agents</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated Agent items = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Token to retrieve the next page of results or empty if there are no more results in the list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string next_page_token = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To see the complete protobuf spec, please visit the <a href="https://github.com/fonoster/routr/tree/main/mods/common/src/connect/protos" target="_blank" rel="noopener noreferrer">protobuf directory.</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="launching-the-apiserver">Launching the APIServer<a class="hash-link" aria-label="Direct link to Launching the APIServer" title="Direct link to Launching the APIServer" href="/docs/2.0.0/development/components/apiserver#launching-the-apiserver">​</a></h2>
<p>Both implementations are available as Docker images from Docker Hub as <code>fonoster/routr-pgdata</code> and <code>fonoster/routr-simpledata</code>.</p>
<p><strong>pgdata</strong></p>
<p>To launch the <code>pgdata</code> implementation with Docker, you can use the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run -it \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e DATABASE_URL=&quot;postgresql://postgres:postgres@localhost:5432/routr&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p 51907:51907 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p 51908:51908 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fonoster/routr-pgdata</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The port <code>51907</code> is used for internal communication, and the port <code>51908</code> is used for external communication. The CTL and SDK use the external port to manage the data.</p>
<p><strong>simpledata</strong></p>
<p>To launch the <code>simpledata</code> implementation with Docker, you can use the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run -it \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v /path/to/resources:/etc/routr/resources \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p 51907:51907 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fonoster/routr-simpledata</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="quick-test-with-grpcurl">Quick Test with gRPCurl<a class="hash-link" aria-label="Direct link to Quick Test with gRPCurl" title="Direct link to Quick Test with gRPCurl" href="/docs/2.0.0/development/components/apiserver#quick-test-with-grpcurl">​</a></h2>
<p>One easy way to interact with the APIServer for testing and development is to use <a href="https://github.com/fullstorydev/grpcurl" target="_blank" rel="noopener noreferrer">gRPCurl</a>. The following example shows how to send a request to the Agents service within the APIServer:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">grpcurl -plaintext \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -import-path /path/to/protos \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -proto agents.proto  -d &#x27;{...}&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  localhost:51907 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fonoster.routr.connect.agents.v2beta1.Agents/Get</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Please remember that the <code>simpledata</code> implementation does not accept write operations.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/fonoster/routr-website/edit/main/versioned_docs/version-2.0.0/development/components/apiserver.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/2.0.0/development/components/rtprelay"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">RTPRelay</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/2.0.0/development/components/simpleauth"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SimpleAuth Service</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/docs/2.0.0/development/components/apiserver#configuration-spec">Configuration Spec</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/2.0.0/development/components/apiserver#communication-and-protobuf-spec">Communication and Protobuf Spec</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/2.0.0/development/components/apiserver#launching-the-apiserver">Launching the APIServer</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/2.0.0/development/components/apiserver#quick-test-with-grpcurl">Quick Test with gRPCurl</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Quick Links</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/2.0.0/overview/introduction">Docs</a></li><li class="footer__item"><a href="https://fonoster.gumroad.com/l/the-future-of-programmable-sip-servers" target="_blank" rel="noopener noreferrer" class="footer__link-item">Training<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/fonoster/routr/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/4QWgSz4hTC" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/fonoster" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://learn.fonoster.com/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/fonoster/routr" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Fonoster, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>